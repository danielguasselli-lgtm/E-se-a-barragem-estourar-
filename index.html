<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E SE A BARRAGEM ESTOURAR?</title>
    <style>
        :root { --red: #ff3e3e; --yellow: #ffeb3b; --bg: #050505; --green: #00ff41; }
        body { background: var(--bg); color: #dcdcdc; font-family: 'Courier New', monospace; margin: 0; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; user-select: none; }
        
        #background-img { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: linear-gradient(rgba(0,0,0,0.85), rgba(0,0,0,0.85)), 
                        url('https://inline-images.googleusercontent.com/image_generation_content/0'); 
            background-size: cover; background-position: center; z-index: -1; 
        }

        #game-container { max-width: 850px; width: 90%; background: rgba(15, 15, 15, 0.98); padding: 40px; border: 1px solid #333; box-shadow: 0 0 50px rgba(0,0,0,1); position: relative; }
        h1 { color: var(--red); text-align: center; letter-spacing: 2px; border-bottom: 2px solid var(--red); padding-bottom: 10px; margin-top: 0; text-transform: uppercase; }
        #status-bar { display: flex; justify-content: space-around; margin-bottom: 20px; background: #000; padding: 10px; border: 1px solid #444; font-size: 0.9em; }
        .stat-value { color: var(--yellow); font-weight: bold; }
        #scene-text { line-height: 1.6; margin-bottom: 30px; font-size: 1.1em; height: 380px; overflow-y: auto; text-align: justify; scrollbar-width: thin; padding-right: 15px; cursor: pointer; white-space: pre-wrap; }
        .choice-btn { display: block; width: 100%; padding: 14px; margin: 8px 0; background: #111; border: 1px solid #444; color: #fff; cursor: pointer; text-transform: uppercase; transition: 0.2s; font-family: 'Courier New', monospace; }
        .choice-btn:hover { background: var(--red); color: #000; font-weight: bold; }
        #dice-area { padding: 15px; margin-bottom: 15px; font-weight: bold; display: none; text-align: center; font-size: 1.4em; border-radius: 4px; border: 1px solid #444; }
        #credits { position: fixed; bottom: 10px; right: 15px; font-size: 0.7em; color: #555; letter-spacing: 1px; text-transform: uppercase; }
        .cursor { display: inline-block; width: 8px; height: 1.2em; background: var(--green); margin-left: 5px; animation: blink 0.8s infinite; }
        @keyframes blink { 50% { opacity: 0; } }
        .shake { animation: shake 0.5s; }
        @keyframes shake { 0% { transform: translate(1px, 1px); } 20% { transform: translate(-3px, 0); } 40% { transform: translate(3px, 2px); } 60% { transform: translate(-1px, -1px); } 100% { transform: translate(0, 0); } }
    </style>
</head>
<body>

<div id="background-img"></div>
<div id="game-container">
    <h1>E se a barragem estourar?</h1>
    <div id="status-bar">
        <div>INTEGRIDADE: <span id="vida" class="stat-value">100</span>%</div>
        <div>EST√ÅGIO: <span id="fase-num" class="stat-value">0/10</span></div>
    </div>
    <div id="scene-text" onclick="skipTypewriter()"></div>
    <div id="dice-area"></div>
    <div id="choices">
        <button class="choice-btn" onclick="mostrarRegras()">[ INICIAR TERMINAL ]</button>
    </div>
</div>
<div id="credits">Autor: Guasselli</div>

<script>
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    let vida = 100, faseAtual = -1;
    let isTyping = false, currentFullText = "", typeTimeout;

    function playSound(type) {
        const now = audioCtx.currentTime;
        const g = audioCtx.createGain(); g.connect(audioCtx.destination);
        const osc = audioCtx.createOscillator();
        if (type === 'click') {
            osc.type = 'sine'; osc.frequency.setValueAtTime(1000 + (Math.random()*200), now);
            g.gain.setValueAtTime(0.008, now); g.gain.exponentialRampToValueAtTime(0.001, now + 0.03);
            osc.connect(g); osc.start(); osc.stop(now + 0.03);
        }
        if (type === 'alivio') {
            const bufferSize = audioCtx.sampleRate * 2;
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) data[i] = Math.random() * 2 - 1;
            const noise = audioCtx.createBufferSource(); noise.buffer = buffer;
            const filter = audioCtx.createBiquadFilter(); filter.type = 'lowpass';
            filter.frequency.setValueAtTime(500, now);
            filter.frequency.exponentialRampToValueAtTime(100, now + 1.2);
            g.gain.setValueAtTime(0, now); g.gain.linearRampToValueAtTime(0.05, now + 0.2);
            g.gain.exponentialRampToValueAtTime(0.001, now + 1.5);
            noise.connect(filter); filter.connect(g); noise.start();
        }
        if (type === 'dado') {
            osc.type = 'square'; osc.frequency.setValueAtTime(100, now);
            g.gain.setValueAtTime(0.03, now); g.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
            osc.connect(g); osc.start(); osc.stop(now + 0.1);
        }
    }

    function typeWriter(text, i, cb) {
        isTyping = true; currentFullText = text;
        const scene = document.getElementById("scene-text");
        if (i < text.length) {
            scene.innerHTML = text.substring(0, i + 1) + '<span class="cursor"></span>';
            scene.scrollTop = scene.scrollHeight;
            if(text.charAt(i) !== " " && text.charAt(i) !== "\n") playSound('click');
            typeTimeout = setTimeout(() => typeWriter(text, i + 1, cb), 35);
        } else { finishTyping(cb); }
    }

    function skipTypewriter() { if (isTyping) { clearTimeout(typeTimeout); finishTyping(window.currentCb); } }

    function finishTyping(cb) {
        isTyping = false;
        document.getElementById("scene-text").innerHTML = currentFullText;
        if (cb) cb();
    }

    async function rolarDadosAnim(totalNecessario, dadoReal) {
        const area = document.getElementById('dice-area');
        area.style.display = "block"; area.style.background = "#000"; area.style.color = "#fff";
        for(let i=0; i<10; i++) {
            area.innerText = `üé≤ CALCULANDO SOBREVIV√äNCIA: ${Math.floor(Math.random()*6)+1}`;
            playSound('dado'); await new Promise(r => setTimeout(r, 200));
        }
        const sucesso = totalNecessario >= 4;
        area.style.background = sucesso ? "var(--green)" : "var(--red)"; area.style.color = "#000";
        area.innerText = `üé≤ RESULTADO: ${dadoReal} -> ${sucesso ? '√âXITO' : 'DANO SOFRIDO'}`;
        if(sucesso) playSound('alivio');
        return sucesso;
    }

    const textoRegras = "REGRAS DE SOBREVIV√äNCIA:\n\n1. O jogo consiste em 10 est√°gios cr√≠ticos.\n2. Para cada decis√£o, um dado de 6 faces ser√° lan√ßado.\n3. Respostas corretas somam +2 ao dado. Respostas incorretas subtraem -2.\n4. Voc√™ precisa de um resultado final 4 ou superior para n√£o sofrer danos.\n5. Se sua INTEGRIDADE chegar a 0%, a simula√ß√£o termina.\n\nClique no texto a qualquer momento para acelerar a digita√ß√£o.";

    const textoPrologo = "Pr√≥logo: O Crep√∫sculo na Orla\n\nO sol est√° se pondo em um final de tarde abafado em Tucuru√≠. Voc√™ est√° sentado em uma das mesas da Orla, sentindo a brisa que vem do Rio Tocantins. √Ä sua frente, uma cuia de tacac√° fumegante, com o cheiro caracter√≠stico do tucupi e do jambu que faz a boca adormecer levemente.\n\nAo redor, o movimento √© normal: crian√ßas correndo, o som distante de um som automotivo e o brilho das luzes da cidade come√ßando a refletir no espelho d'√°gua. Ao fundo, a gigante de concreto ‚Äî a Usina Hidrel√©trica de Tucuru√≠ ‚Äî repousa como uma muralha familiar no horizonte.\n\nDe repente, o som ambiente √© cortado. N√£o √© um trov√£o. √â um estalo seco, seguido por um vibrar profundo que voc√™ sente na sola dos p√©s, antes mesmo de ouvir. O tacac√° na sua cuia treme, formando pequenas ondas.\n\nSegundos depois, a sirene de emerg√™ncia corta o ar com um som agudo e desesperador que voc√™ s√≥ tinha ouvido em simula√ß√µes... mas desta vez, as luzes da cidade piscam e se apagam por completo. O sil√™ncio que se segue √© interrompido pelo grito de algu√©m pr√≥ximo ao parapeito:\n\n\"‚Äî A √ÅGUA T√Å SUBINDO! CORRE!\"\n\nO p√¢nico √© instant√¢neo. A cuia cai no ch√£o, o jambu ainda amortece sua l√≠ngua, mas seu cora√ß√£o dispara. A sobreviv√™ncia come√ßou.";

    const fases = [
        { t: "FASE 1: O Caos no Cais\n\nO c√©u de Tucuru√≠, antes alaranjado, parece escurecer com a n√©voa de √°gua que levanta l√° longe. O barulho de cornetas de navios no porto se mistura aos gritos de 'A barragem estourou!'.\n\nVoc√™ v√™ a √°gua engolindo os primeiros bancos da orla. O p√¢nico √© um cheiro met√°lico no ar. A multid√£o corre para o porto tentando salvar barcos, outros entram nos carros.\n\nO que voc√™ faz enquanto a √°gua sobe cent√≠metros por segundo nos seus p√©s?", c: ["Salvar embarca√ß√µes no porto", "Subir para a Vila Permanente", "Fugir pela avenida da orla"], r: 1, dano: 30 },
        { t: "FASE 2: A Armadilha da BR-422\n\nVoc√™ est√° ofegante. Ao tentar cruzar a pista principal, o cen√°rio √© de guerra: carros abandonados com portas abertas e o som de buzinas travadas.\n\nA √°gua j√° desce pelas ladeiras como cachoeiras de lama. Ela est√° batendo na sua canela, parece inofensiva, mas voc√™ sente o ch√£o 'fugir' sob suas botas.\n\nVoc√™ precisa chegar ao outro lado, mas a correnteza ruge contra as rodas dos carros. √â seguro colocar o p√© nessa √°gua?", c: ["Sim, a √°gua est√° baixa", "N√£o, a press√£o pode derrubar", "Correr o mais r√°pido poss√≠vel"], r: 1, dano: 30 },
        { t: "FASE 3: A Encruzilhada do Getat\n\nO suor escorre pelos seus olhos. Voc√™ chega a um ponto onde as luzes de emerg√™ncia de um transformador estouram em fa√≠scas verdes.\n\nDe um lado, o Getat parece um caminho mais largo, do outro, a subida √≠ngreme para a Vila Permanente. O barulho da √°gua batendo nas casas l√° embaixo √© como o de um trem descarrilando.\n\nSem sinal de celular, qual caminho garante que voc√™ n√£o ser√° cercado pela √°gua em uma bacia natural?", c: ["Seguir para o Getat", "Subir para a Vila Permanente", "Ir para o Mercado Municipal"], r: 1, dano: 25 },
        { t: "FASE 4: O Estalo da Morte\n\nUm poste da rede de alta tens√£o da empresa respons√°vel tomba pesadamente sobre um muro de arrimo √† sua frente. O cabo de cobre chicoteia a po√ßa d'√°gua, emitindo um estalo seco e um cheiro de oz√¥nio queimado.\n\nVoc√™ est√° no raio de alcance da eletricidade que se espalha pelo ch√£o molhado. Seus pelos do bra√ßo se arrepiam. Voc√™ sente uma vibra√ß√£o estranha nas pernas.\n\nComo sair desse raio de morte sem virar um condutor vivo?", c: ["Dar passos largos para fugir", "P√©s juntos arrastando-os ou pulando colados", "Correr em ziguezague"], r: 1, dano: 100 },
        { t: "FASE 5: A Noite de Chuva\n\nVoc√™ atingiu um ponto alto, mas est√° encharcado. A adrenalina baixou e o frio da noite amaz√¥nica come√ßa a castigar. A chuva de Tucuru√≠ n√£o para, e o vento corta suas roupas molhadas.\n\nSeus l√°bios est√£o roxos. Voc√™ est√° faminto e com sede, mas seu corpo come√ßa a tremer incontrolavelmente.\n\nO que voc√™ resolve primeiro para n√£o desmaiar antes do amanhecer?", c: ["Buscar comida imediata", "Priorizar abrigo contra hipotermia", "Tentar sinal de celular"], r: 1, dano: 25 },
        { t: "FASE 6: O Gosto do Barro\n\nO dia amanhece e o cen√°rio √© desolador: Tucuru√≠ virou um mar de lama marrom. A sede √© insuport√°vel, sua garganta arde.\n\nVoc√™ encontra uma garrafa pet com √°gua de chuva coletada de um telhado de amianto, cheia de fuligem e detritos.\n\nA vontade √© virar a garrafa de uma vez, mas voc√™ sabe que um surto de c√≥lera ou leptospirose seria sua senten√ßa de morte. Como purificar isso?", c: ["10 gotas de cloro", "2 gotas de hipoclorito (esperar 30 min)", "Beber direto"], r: 1, dano: 40 },
        { t: "FASE 7: O Inimigo Silencioso\n\nVoc√™ est√° descansando em um amontoado de tijolos quando percebe algo se movendo entre as fendas. Com a cidade inundada, as matas vizinhas expulsaram tudo o que vive no ch√£o.\n\nUm escorpi√£o preto gigante ergue a cauda a poucos cent√≠metros da sua m√£o. O susto √© grande. Se ele te picar, o socorro m√©dico √© inexistente no momento.\n\nQual erro voc√™ n√£o pode cometer se o pior acontecer?", c: ["Lavar com sab√£o", "Fazer torniquete ou sugar o veneno", "Manter a calma"], r: 1, dano: 50 },
        { t: "FASE 8: O Som dos Rotores\n\nO barulho r√≠tmico de um helic√≥ptero 'Sap√£o' corta o c√©u cinzento. Ele est√° longe, sobrevoando os telhados que ficaram de fora. Voc√™ corre para uma clareira de barro seco.\n\nEles est√£o procurando sobreviventes, mas o brilho do sol na √°gua dificulta a vis√£o deles.\n\nVoc√™ precisa mandar uma mensagem clara do ch√£o que seja um pedido de socorro m√©dico urgente.", c: ["Sinalizar com letra V", "Sinalizar com letra X", "Acenar freneticamente"], r: 1, dano: 0 },
        { t: "FASE 9: A Manada Humana\n\nUm grito ecoa no acampamento: 'A barragem auxiliar cedeu! Outra onda!'. √â mentira, mas o p√¢nico √© contagioso. Centenas de pessoas correm desesperadas em uma escadaria estreita.\n\nO empurra-empurra √© violento. Voc√™ corre o risco de ser pisoteado.\n\nComo voc√™ se posiciona para proteger seus √≥rg√£os vitais e n√£o cair enquanto a massa humana te arrasta?", c: ["Correr contra o fluxo", "Diagonal com fluxo, bra√ßos no peito", "Deitar no ch√£o"], r: 1, dano: 50 },
        { t: "FASE 10: O Vale de Sombras\n\nTr√™s dias depois. A √°gua recuou, deixando lama f√©tida. Voc√™ volta √† sua rua. As casas parecem de p√©, mas marcas de √°gua atingem o teto.\n\nO solo sob seus p√©s parece 'fofo'. A casa d√° um estalo surdo. Voc√™ quer entrar para buscar documentos.\n\nQual o perigo real de uma estrutura que sobreviveu √† inunda√ß√£o, mas agora est√° secando?", c: ["Infesta√ß√£o de insetos", "Recalque diferencial (v√°cuo no solo)", "Falta de oxig√™nio"], r: 1, dano: 100 }
    ];

    function mostrarRegras() {
        audioCtx.resume(); document.getElementById('choices').innerHTML = "";
        window.currentCb = () => { document.getElementById('choices').innerHTML = `<button class="choice-btn" onclick="iniciarSistema()">[ COMPREENDIDO ]</button>`; };
        typeWriter(textoRegras, 0, window.currentCb);
    }

    function iniciarSistema() {
        faseAtual = -1; document.getElementById('choices').innerHTML = "";
        window.currentCb = () => { document.getElementById('choices').innerHTML = `<button class="choice-btn" onclick="proximaFase()">[ ENTRAR NA √ÅREA DE RISCO ]</button>`; };
        typeWriter(textoPrologo, 0, window.currentCb);
    }

    function proximaFase() {
        faseAtual++; if(faseAtual >= fases.length) { finalizar("SIMULA√á√ÉO CONCLU√çDA. VOC√ä SOBREVIVEU AO GRANDE FLUXO."); return; }
        renderFase();
    }

    function renderFase() {
        const f = fases[faseAtual]; document.getElementById('fase-num').innerText = `${faseAtual + 1}/10`;
        document.getElementById('choices').innerHTML = ""; document.getElementById('dice-area').style.display = "none";
        window.currentCb = () => {
            f.c.forEach((op, i) => {
                const b = document.createElement("button"); b.className = "choice-btn"; b.innerText = op;
                b.onclick = () => processar(i); document.getElementById('choices').appendChild(b);
            });
        };
        typeWriter(f.t, 0, window.currentCb);
    }

    async function processar(escolha) {
        document.getElementById('choices').innerHTML = "";
        const f = fases[faseAtual]; const dadoReal = Math.floor(Math.random() * 6) + 1;
        const total = dadoReal + (escolha === f.r ? 2 : -2);
        const sucesso = await rolarDadosAnim(total, dadoReal);
        setTimeout(() => {
            if(!sucesso) {
                vida -= f.dano; document.getElementById('vida').innerText = Math.max(0, vida);
                document.getElementById('game-container').classList.add('shake');
                setTimeout(() => document.getElementById('game-container').classList.remove('shake'), 500);
            }
            if(vida <= 0) finalizar("SINAIS VITAIS PERDIDOS. O JOGADOR N√ÉO RESISTIU.");
            else document.getElementById('choices').innerHTML = `<button class="choice-btn" onclick="proximaFase()">[ CONTINUAR ]</button>`;
        }, 600);
    }

    function finalizar(m) {
        document.getElementById('scene-text').innerHTML = "";
        typeWriter(m, 0, () => { document.getElementById('choices').innerHTML = `<button class="choice-btn" onclick="location.reload()">[ REINICIAR PROTOCOLO ]</button>`; });
    }
</script>
</body>
</html>
